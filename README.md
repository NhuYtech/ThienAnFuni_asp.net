# ğŸ›’ Website bÃ¡n hÃ ng ná»™i tháº¥t ThiÃªn Ã‚n â€“ Cáº§n ThÆ¡

ğŸ“Œ **Äá»“ Ã¡n mÃ´n Há»‡ thá»‘ng thÃ´ng tin 1**  
ğŸ“ TrÆ°á»ng Äáº¡i há»c Ká»¹ thuáº­t â€“ CÃ´ng nghá»‡ Cáº§n ThÆ¡ (CTUT)  
ğŸ‘¨â€ğŸ« Giáº£ng viÃªn hÆ°á»›ng dáº«n: TS. Nguyá»…n Trung Viá»‡t

ğŸ‘¨â€ğŸ’» NhÃ³m sinh viÃªn thá»±c hiá»‡n:  
- Huá»³nh NhÆ° Ã â€“ HTTT2211015  
- Nguyá»…n ThÃ nh Äáº¡t â€“ HTTT2211003  
- Nguyá»…n Tráº§n Anh Khoa â€“ HTTT2211026  

---

## ğŸ¯ Má»¥c tiÃªu cá»§a há»‡ thá»‘ng

Há»‡ thá»‘ng Ä‘Æ°á»£c xÃ¢y dá»±ng nháº±m há»— trá»£ CÃ´ng ty ThiÃªn Ã‚n táº¡i Cáº§n ThÆ¡ trong quÃ¡ trÃ¬nh chuyá»ƒn Ä‘á»•i tá»« mÃ´ hÃ¬nh kinh doanh truyá»n thá»‘ng sang mÃ´ hÃ¬nh thÆ°Æ¡ng máº¡i Ä‘iá»‡n tá»­, giÃºp:

- TÄƒng kháº£ nÄƒng tiáº¿p cáº­n khÃ¡ch hÃ ng tiá»m nÄƒng.
- Tá»± Ä‘á»™ng hÃ³a quy trÃ¬nh bÃ¡n hÃ ng, quáº£n lÃ½ Ä‘Æ¡n hÃ ng vÃ  sáº£n pháº©m.
- Cung cáº¥p tráº£i nghiá»‡m mua sáº¯m tiá»‡n lá»£i, hiá»‡n Ä‘áº¡i cho khÃ¡ch hÃ ng.

---

## ğŸ§© CÃ¡c chá»©c nÄƒng chÃ­nh

### ğŸ‘¤ Quáº£n lÃ½ tÃ i khoáº£n
- ÄÄƒng nháº­p/Ä‘Äƒng xuáº¥t
- Cáº­p nháº­t thÃ´ng tin cÃ¡ nhÃ¢n
- PhÃ¢n quyá»n: Admin, NhÃ¢n viÃªn, KhÃ¡ch hÃ ng

### ğŸ›ï¸ Quáº£n lÃ½ sáº£n pháº©m
- ThÃªm, sá»­a, xÃ³a sáº£n pháº©m
- Quáº£n lÃ½ danh má»¥c sáº£n pháº©m
- Xem chi tiáº¿t sáº£n pháº©m

### ğŸ“¦ Quáº£n lÃ½ Ä‘Æ¡n hÃ ng
- Äáº·t hÃ ng, xÃ¡c nháº­n Ä‘Æ¡n hÃ ng
- Theo dÃµi tÃ¬nh tráº¡ng Ä‘Æ¡n hÃ ng
- Lá»‹ch sá»­ mua hÃ ng

### ğŸ§‘â€ğŸ¤â€ğŸ§‘ Quáº£n lÃ½ ngÆ°á»i dÃ¹ng
- Quáº£n lÃ½ thÃ´ng tin khÃ¡ch hÃ ng
- Quáº£n lÃ½ nhÃ¢n viÃªn bÃ¡n hÃ ng

### ğŸ­ Quáº£n lÃ½ nhÃ  cung cáº¥p & nháº­p hÃ ng
- ThÃªm, sá»­a, xÃ³a nhÃ  cung cáº¥p
- Ghi nháº­n lÃ´ hÃ ng nháº­p kho

### ğŸ“Š Dashboard & thá»‘ng kÃª
- Tá»•ng quan khÃ¡ch hÃ ng, sáº£n pháº©m, Ä‘Æ¡n hÃ ng, doanh thu
- Thá»‘ng kÃª sáº£n pháº©m sáº¯p háº¿t hÃ ng
- BÃ¡o cÃ¡o doanh thu theo thá»i gian

---

## ğŸ› ï¸ CÃ´ng nghá»‡ sá»­ dá»¥ng

| ThÃ nh pháº§n             | CÃ´ng nghá»‡                   |
|------------------------|-----------------------------|
| NgÃ´n ngá»¯ láº­p trÃ¬nh     | C#, HTML/CSS, JavaScript    |
| Framework chÃ­nh        | ASP.NET Core MVC            |
| ORM                    | Entity Framework Core       |
| CÆ¡ sá»Ÿ dá»¯ liá»‡u          | Microsoft SQL Server        |
| Thiáº¿t káº¿ giao diá»‡n     | Razor Pages, Bootstrap      |
| MÃ´ hÃ¬nh hÃ³a            | PlantUML (Use Case, Class)  |

---

## ğŸ‘¥ Äá»‘i tÆ°á»£ng sá»­ dá»¥ng

- **Quáº£n lÃ½ cá»­a hÃ ng (Admin)**: Quáº£n lÃ½ toÃ n bá»™ há»‡ thá»‘ng, nhÃ¢n viÃªn, sáº£n pháº©m, Ä‘Æ¡n hÃ ng, thá»‘ng kÃª.
- **NhÃ¢n viÃªn bÃ¡n hÃ ng**: Quáº£n lÃ½ khÃ¡ch hÃ ng, Ä‘Æ¡n hÃ ng, Ä‘áº·t hÃ ng cho khÃ¡ch.
- **KhÃ¡ch hÃ ng**: ÄÄƒng kÃ½ tÃ i khoáº£n, duyá»‡t sáº£n pháº©m, mua hÃ ng, xem lá»‹ch sá»­.

---

## ğŸ’¡ CÃ¡c Ä‘iá»ƒm ná»•i báº­t

- ğŸ§  á»¨ng dá»¥ng mÃ´ hÃ¬nh MVC giÃºp dá»… dÃ ng má»Ÿ rá»™ng vÃ  báº£o trÃ¬.
- ğŸ” PhÃ¢n quyá»n ngÆ°á»i dÃ¹ng rÃµ rÃ ng theo vai trÃ².
- ğŸ“ˆ Dashboard thá»‘ng kÃª trá»±c quan.
- ğŸ›’ Giao diá»‡n thÃ¢n thiá»‡n, há»— trá»£ thao tÃ¡c nhanh gá»n.
- ğŸ’¾ LÆ°u trá»¯ dá»¯ liá»‡u an toÃ n vá»›i SQL Server.

---

## ğŸ“Œ Ghi chÃº

ÄÃ¢y lÃ  Ä‘á»“ Ã¡n há»c pháº§n Há»‡ thá»‘ng thÃ´ng tin 1, Ä‘Æ°á»£c thá»±c hiá»‡n táº¡i TrÆ°á»ng Äáº¡i há»c Ká»¹ thuáº­t â€“ CÃ´ng nghá»‡ Cáº§n ThÆ¡, nháº±m mÃ´ phá»ng vÃ  hiá»‡n thá»±c hÃ³a quy trÃ¬nh bÃ¡n hÃ ng thá»±c táº¿ táº¡i **cÃ´ng ty bÃ¡n hÃ ng ná»™i tháº¥t ThiÃªn Ã‚n â€“ Cáº§n ThÆ¡**.

---

## ğŸ“¬ LiÃªn há»‡

- ğŸ‘©â€ğŸ’» Sinh viÃªn: **Huá»³nh NhÆ° Ã** â€“ HTTT2211015  
- ğŸ“ Hotline: 0982 147 252  
- ğŸ“§ Email: huynhnhuy.tech@gmail.com
- ğŸ”— GitHub: [https://github.com/NhuYtech](https://github.com/NhuYtech)

---

ğŸ’» *Source code hiá»‡n Ä‘ang Ä‘Æ°á»£c phÃ¡t triá»ƒn vÃ  cáº­p nháº­t thÆ°á»ng xuyÃªn táº¡i:*  
ğŸ”— [https://github.com/NhuYtech/ThienAnFuni_aspnet](https://github.com/NhuYtech/ThienAnFuni_asp.net)

---

# Account:
- `Admin`: 
  - `Username`: `sinoo`
  - `Password`: `123456`

- `SaleStaff 1`:
  - `Username`: `tramanh`
  - `Password`: `123456`

- `Customer 1`:
  - `Username`: `teoemcus`
  - `Password`: `123456`
  
# `Work Assignment`
### Anh Khoa
- Viáº¿t bÃ¡o cÃ¡o
- Chá»n template Customer + Admin
- Thiáº¿t káº¿ Database
- Cáº¯t template: Admin, Shop
- Account: ÄÄƒng nháº­p
- XÃ¢y dá»±ng module Admin: POS bÃ¡n hÃ ng, NhÃ¢n viÃªn, Sáº£n pháº©m, Nháº­p hÃ ng, NhÃ  cung cáº¥p
- XÃ¢y dá»±ng module Customer: Shop, Giá» hÃ ng(Session), Äáº·t hÃ ng(Send Email)


### ThÃ nh Äáº¡t
- Viáº¿t bÃ¡o cÃ¡o
- Thiáº¿t káº¿ Database
- Cáº¯t template: Trang chá»§
- XÃ¢y dá»±ng module Admin: Dashboad quáº£n trá»‹, Danh má»¥c sáº£n pháº©m
- XÃ¢y dá»±ng module Customer: Trang chá»§, ÄÆ¡n hÃ ng(Chi tiáº¿t Ä‘Æ¡n hÃ ng), LiÃªn há»‡
- Style UI: Pagination
- Thiáº¿t káº¿ UI/UX: BÃ´ng tuyáº¿t, Panel, Logo 


### NhÆ° Ã
- Sá»­a bÃ¡o cÃ¡o
- Account: ÄÄƒng kÃ½, Äá»•i máº­t kháº©u
- XÃ¢y dá»±ng module Admin: KhÃ¡ch hÃ ng
- XÃ¢y dá»±ng module Customer: Profile
- Nháº­p dá»¯ liá»‡u máº«u: Sáº£n pháº©m, ÄÆ¡n hÃ ng
- Chá»‰nh sá»­a logic code: NhÃ¢n viÃªn, Chi tiáº¿t sáº£n pháº©m, Chi tiáº¿t Ä‘Æ¡n hÃ ng
- Láº¥y dá»¯ liá»‡u hÃ¬nh áº£nh, MÃ´ táº£ sáº£n pháº©m


# Láº§n pull Ä‘áº§u tiÃªn
```
- Táº¡o database thienanFuni
- má»Ÿ file appsettings.json Ä‘á»•i tÃªn server
```
# Fresh 
```
dotnet ef database drop --force

dotnet ef migrations remove

dotnet ef migrations add InitialCreate

```

### 1. Táº¡o Dá»± Ãn ASP.NET Core 8.0 MVC

### 2. CÃ i Äáº·t ThÆ° Viá»‡n Identity vÃ  setup mÃ´i trÆ°á»ng nhÆ° nÃ y

- **Identity** giÃºp báº¡n quáº£n lÃ½ xÃ¡c thá»±c, phÃ¢n quyá»n vÃ  Ä‘Äƒng nháº­p/Ä‘Äƒng xuáº¥t má»™t cÃ¡ch dá»… dÃ ng.

   ```powershell
    dotnet add package Microsoft.AspNetCore.Diagnostics.EntityFrameworkCore
    dotnet add package Microsoft.AspNetCore.Identity.EntityFrameworkCore
    dotnet add package Microsoft.AspNetCore.Identity.UI
    dotnet add package Microsoft.EntityFrameworkCore.Sqlite
    dotnet add package Microsoft.EntityFrameworkCore.SqlServer
    dotnet add package Microsoft.EntityFrameworkCore.Tools
    dotnet add package Microsoft.VisualStudio.Web.CodeGeneration.Design
   ```

### 3. Cáº¥u HÃ¬nh Database Context

- Táº¡o **ApplicationDbContext** káº¿ thá»«a tá»« `IdentityDbContext` Ä‘á»ƒ Identity quáº£n lÃ½ cÆ¡ sá»Ÿ dá»¯ liá»‡u.

1. **Táº¡o lá»›p ApplicationDbContext**:
   ```csharp
   using Microsoft.AspNetCore.Identity;
   using Microsoft.AspNetCore.Identity.EntityFrameworkCore;
   using Microsoft.EntityFrameworkCore;

   public class ApplicationDbContext : IdentityDbContext<User>
   {
       public ApplicationDbContext(DbContextOptions<ApplicationDbContext> options) : base(options) { }

       public DbSet<Manager> Managers { get; set; }
       public DbSet<SaleStaff> SaleStaffs { get; set; }
       public DbSet<Customer> Customers { get; set; }
   }
   ```

2. **Cáº¥u hÃ¬nh chuá»—i káº¿t ná»‘i trong `appsettings.json`**:
   ```json
   "ConnectionStrings": {
       "DefaultConnection": "Server=(localdb)\\mssqllocaldb;Database=YourDatabaseName;Trusted_Connection=True;MultipleActiveResultSets=true"
   }
   ```

3. **ThÃªm ApplicationDbContext vÃ o `Program.cs`**:
   ```csharp
   builder.Services.AddDbContext<ApplicationDbContext>(options =>
       options.UseSqlServer(builder.Configuration.GetConnectionString("DefaultConnection")));

   builder.Services.AddIdentity<User, IdentityRole>()
       .AddEntityFrameworkStores<ApplicationDbContext>()
       .AddDefaultTokenProviders();

   builder.Services.AddControllersWithViews();
   ```

### 4. Cáº­p Nháº­t Model NgÆ°á»i DÃ¹ng Vá»›i Identity

- Äá»ƒ phÃ¹ há»£p vá»›i cáº¥u trÃºc cá»§a Identity, cáº­p nháº­t cÃ¡c model `User`, `Manager`, `SaleStaff`, vÃ  `Customer` theo Ä‘á»‹nh nghÄ©a cá»§a báº¡n á»Ÿ trÃªn.

### 5. Thiáº¿t Láº­p Báº£ng Role Cho NgÆ°á»i DÃ¹ng

- Táº¡o má»™t `RoleInitializer` Ä‘á»ƒ thÃªm cÃ¡c role cÆ¡ báº£n vÃ o há»‡ thá»‘ng khi cháº¡y láº§n Ä‘áº§u:

   ```csharp
   using Microsoft.AspNetCore.Identity;
   using System.Threading.Tasks;

   public class RoleInitializer
   {
       public static async Task SeedRolesAsync(RoleManager<IdentityRole> roleManager)
       {
           if (!await roleManager.RoleExistsAsync("Manager"))
           {
               await roleManager.CreateAsync(new IdentityRole("Manager"));
           }
           if (!await roleManager.RoleExistsAsync("SaleStaff"))
           {
               await roleManager.CreateAsync(new IdentityRole("SaleStaff"));
           }
           if (!await roleManager.RoleExistsAsync("Customer"))
           {
               await roleManager.CreateAsync(new IdentityRole("Customer"));
           }
       }
   }
   ```

- **ThÃªm lá»‡nh gá»i SeedRoles** trong `Program.cs`:
   ```csharp
   using Microsoft.AspNetCore.Identity;

   var app = builder.Build();

   using (var scope = app.Services.CreateScope())
   {
       var roleManager = scope.ServiceProvider.GetRequiredService<RoleManager<IdentityRole>>();
       await RoleInitializer.SeedRolesAsync(roleManager);
   }
   ```

### 6. Táº¡o AccountController

Táº¡o `AccountController` Ä‘á»ƒ quáº£n lÃ½ cÃ¡c `Action` Ä‘Äƒng kÃ½, Ä‘Äƒng nháº­p, vÃ  Ä‘Äƒng xuáº¥t.



### 7. PhÃ¢n Quyá»n Cho CÃ¡c Controller

- DÃ¹ng `[Authorize(Roles = "RoleName")]` Ä‘á»ƒ phÃ¢n quyá»n. VÃ­ dá»¥:
   ```csharp
   [Authorize(Roles = "Manager")]
   public class AdminController : Controller
   {
       // Chá»‰ cÃ³ Manager má»›i truy cáº­p Ä‘Æ°á»£c
   }

   [Authorize(Roles = "SaleStaff")]
   public class SaleController : Controller
   {
       // Chá»‰ cÃ³ SaleStaff má»›i truy cáº­p Ä‘Æ°á»£c
   }
   ```

### 8. Migrate vÃ  Cháº¡y á»¨ng Dá»¥ng (Fresh) á»Ÿ Ä‘áº§u file

### ====================================================================

# 1. CÃ¡ch setup send mail (Thá»§ cÃ´ng)

### **Gá»­i Email Sau Khi Äáº·t HÃ ng ThÃ nh CÃ´ng**  

**TÃ­ch há»£p gá»­i email miá»…n phÃ­ báº±ng SMTP** sá»­ dá»¥ng dá»‹ch vá»¥ Gmail.  

---

### **BÆ°á»›c 1: Cáº¥u hÃ¬nh dá»‹ch vá»¥ gá»­i email**  

**ThÃªm cÃ i Ä‘áº·t SMTP trong `appsettings.json`:**  
```json
 "EmailSettings": {
    "SmtpServer": "smtp.gmail.com",
    "SmtpPort": 587,
    "SenderName": "ThiÃªn Ã‚n Store",
    "SenderEmail": "Khoalmht0@gmail.com",
    "SenderPassword": "jfka bvsp wvlp rzlb" (Pháº§n nÃ y táº¡o báº±ng cÃ¡c báº­t FA2 vÃ  Create Application Password trÃªn tÃ i khoáº£n google)
  }
```

---

### **BÆ°á»›c 2: ÄÄƒng kÃ½ dá»‹ch vá»¥ gá»­i email trong `Program.cs`**  

```csharp
builder.Services.Configure<EmailSettings>(builder.Configuration.GetSection("EmailSettings"));
builder.Services.AddTransient<ThienAnFuni.Services.IEmailSender, EmailSender>();
```

**Táº¡o lá»›p `EmailSettings.cs`:**  
```csharp
public class EmailSettings
{
    public string SmtpServer { get; set; }
    public int SmtpPort { get; set; }
    public string SenderName { get; set; }
    public string SenderEmail { get; set; }
    public string SenderPassword { get; set; }
}
```

**Táº¡o giao diá»‡n `IEmailSender.cs`:**  
```csharp
public interface IEmailSender
{
    Task SendEmailAsync(string toEmail, string subject, string message);
}
```

**Táº¡o lá»›p `EmailSender.cs`:**  
```csharp
public class EmailSender : IEmailSender
    {
        private readonly EmailSettings _emailSettings;

        public EmailSender(IOptions<EmailSettings> emailSettings)
        {
            _emailSettings = emailSettings.Value;
        }

        public async Task SendEmailAsync(string toEmail, string subject, string message)
        {
            using (var smtpClient = new SmtpClient(_emailSettings.SmtpServer, _emailSettings.SmtpPort))
            {
                smtpClient.Credentials = new NetworkCredential(
                    _emailSettings.SenderEmail,
                    _emailSettings.SenderPassword
                );

                smtpClient.EnableSsl = true;
                smtpClient.UseDefaultCredentials = false;
                smtpClient.DeliveryMethod = SmtpDeliveryMethod.Network; // ThÃªm dÃ²ng nÃ y

                var mailMessage = new MailMessage
                {
                    From = new MailAddress(_emailSettings.SenderEmail, _emailSettings.SenderName),
                    Subject = subject,
                    Body = message,
                    IsBodyHtml = true,
                };

                mailMessage.To.Add(toEmail);

                try
                {
                    await smtpClient.SendMailAsync(mailMessage);
                }
                catch (SmtpException ex)
                {
                    Console.WriteLine($"Lá»—i khi gá»­i email: {ex.Message} - {ex.StatusCode}");
                    Console.WriteLine($"Chi tiáº¿t lá»—i: {ex.InnerException?.Message}");
                    throw;
                }

            }
        }

    }
```

---

### **BÆ°á»›c 3: Cáº­p Nháº­t Controller Äáº·t HÃ ng**  

**ThÃªm vÃ o `CheckOutSV`:**  
```csharp
 if (order != null)
            {
                string subject = "ğŸ’•ğŸ’•ğŸ’• Äáº·t HÃ ng ThÃ nh CÃ´ng - ThiÃªn Ã‚n Store ğŸ’•ğŸ’•ğŸ’•";
                string message = $@"
                <h2>ğŸ’ŒCáº£m Æ¡n báº¡n Ä‘Ã£ Ä‘áº·t hÃ ng táº¡i ThiÃªn Ã‚n Store!ğŸ’Œ</h2>
                <p>ğŸ ÄÆ¡n hÃ ng #{order.Id} Ä‘Ã£ Ä‘Æ°á»£c táº¡o thÃ nh cÃ´ng.</p>
                <p>ğŸ Äá»‹a chá»‰ giao hÃ ng: {order.Address}</p>
                <p>ğŸ Tá»•ng sá»‘ lÆ°á»£ng: {order.TotalQuantity}</p>
                <p>ğŸ Tá»•ng giÃ¡: {order.TotalPrice:n0}Ä‘</p>
                <p>ChÃºng tÃ´i sáº½ liÃªn há»‡ vá»›i báº¡n sá»›m nháº¥t Ä‘á»ƒ giao hÃ ng â¤ï¸.</p>";

                await _emailSender.SendEmailAsync(user.Email, subject, message);
            }
```

---

